<html>

<head>
    <link rel="stylesheet" href="https://newcss.net/new.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap">

    <style>
        * {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 10;
        }

        textarea,
        button {
            width: 100%;
        }

        textarea {
            height: 150px;
        }
    </style>
</head>

<body>
    <h1>QMK Configuratorã®ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ã€ãƒŠãƒ³ãƒãƒ£ãƒƒãƒ†JISå¯¾å¿œã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h1>
    <h2>Overview</h2>
    <p>
        <a href="https://config.qmk.fm/" target="_brank">QMK_Configurator</a>ã§ä½œã£ãŸã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ã€JISè¨­å®šã®ç’°å¢ƒç”¨ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚USâ†”JISã§é•ã†è¨˜å·ã®ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã ã‘æ–‡å­—åˆ—ç½®æ›ã™ã‚‹åŠ›æŠ€ä»•æ§˜ã€‚
    </p>
    <p>
        QMK Configuratorã§ãƒ“ãƒ«ãƒ‰ã—ã¦<a href="https://github.com/qmk/qmk_toolbox">QMK&nbsp;Toolbox</a>ã§æ›¸ãè¾¼ã‚ã°ã€QMKç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã„ã‚‰ãšã§æ—¥æœ¬èªé…åˆ—ã®è‡ªä½œã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’è¨­å®šã§ãã‚‹ã¯ãšã€‚
    </p>
    <p>
        æœ¬å½“ã¯QMKã®<a href="https://github.com/qmk/qmk_firmware/blob/master/quantum/keymap_extras/keymap_jp.h"
            target="=_blank">keymap_jp.h</a>ã‚’ä½¿ã£ã¦ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ä½œã‚ŠãŸã„ã‘ã‚Œã©ã€QMKç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«æŒ«æŠ˜ã—ãŸã€ãã‚“ãªã¨ãã«ã€‚
    </p>
    <h2>Usage</h2>
    <ol>
        <li>QMK Configuratorã§ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’ä½œæˆã—ã¦ã€Keymap.jsonã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹</li>
        <li>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ä¸‹ã®ã€ŒINPUTã€ãƒœãƒƒã‚¯ã‚¹ã«ã‚³ãƒ”ãƒšã™ã‚‹</li>
        <li>ã€ŒConvert & Download Keymap.jsonã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>
        <li>æˆåŠŸã™ã‚‹ã¨å¤‰æ›æ¸ˆã¿jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå§‹ã¾ã‚‹ã®ã§ã€ãã‚Œã‚’QMK Configurator ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹</li>
        <li>ã‚ã¨ã¯ã‚ˆã—ãªã«</li>
    </ol>
    <hr>
    <a href="javascript:test();"><small>ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«ã‚­ãƒ¼ãƒãƒƒãƒ—</small></a>
    <form>
        <label>INPUT</label><br>
        <textarea id="input"></textarea>
        <button type="button" onclick="execute_convert()">ğŸ”¥ Convert & Download Keymap.json ğŸ”¥</button>
    </form>
<hr>
    <form>
    <label>Convert log</label><br>
    <textarea id="log"></textarea>
</form>

    <h2>Memo</h2>
    <ul>
        <li>å¤‰æ›ã§ãã‚‹ã®ã¯ã€QMK Configuratorã®ã€ŒShifted Symblesã€æ¬„ã‹ã‚‰é¸ã‚“ã è¨˜å·ã§ã™ã€‚<code>S(KC_2)</code>ã¨ã‹è¨­å®šã—ãŸã‚­ãƒ¼ã¯ã€ã„ã¾ã®ã¨ã“ã‚å¤‰æ›ã§ãã¾ã›ã‚“ã€‚</li>
        <li>ã‚‚ã—ã‹ã—ãŸã‚‰æŠœã‘ã¦ã‚‹è¨˜å·ãŒã‚ã‚‹ã‹ã‚‚ã€‚</li>
        <li>ãƒã‚°ãŒã‚ã‚‹ã‹ã‚‚ã€‚</li>
        <li><a href="https://github.com/atsuyuki/qmk-configrator-jis-like-converter" target="_blank">Github</a></li>
    </ul>
</body>

<script>
    let test = () => {
        document.getElementById('input').value = JSON.stringify(
            {
                "version": 1,
                "notes": "",
                "documentation": "\"This file is a QMK Configurator export. You can import this at <https://config.qmk.fm>. It can also be used directly with QMK's source code.\n\nTo setup your QMK environment check out the tutorial: <https://docs.qmk.fm/#/newbs>\n\nYou can convert this file to a keymap.c using this command: `qmk json2c {keymap}`\n\nYou can compile this keymap using this command: `qmk compile {keymap}`\"\n",
                "keyboard": "handwired/dactyl_manuform/4x5",
                "keymap": "mymap",
                "layout": "LAYOUT",
                "layers": [
                    ["KC_Q", "KC_W", "KC_E", "KC_R", "KC_T", "KC_Y", "KC_U", "KC_I", "KC_O", "KC_P", "KC_A", "KC_S", "KC_D", "KC_F", "KC_G", "KC_H", "KC_J", "KC_K", "KC_L", "KC_MINS", "KC_Z", "KC_X", "KC_C", "KC_V", "KC_B", "KC_N", "KC_M", "KC_COMM", "KC_DOT", "KC_QUES", "KC_ESC", "KC_LALT", "KC_DQUO", "KC_EQL", "LCTL_T(KC_TAB)", "LT(1,KC_SPC)", "KC_BSPC", "KC_ENT", "MO(2)", "KC_LSFT", "KC_UP", "KC_RGHT", "LT(3,KC_ENT)", "KC_LGUI", "KC_LEFT", "KC_DOWN"],
                    ["RESET", "KC_UP", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_7", "KC_8", "KC_9", "KC_LEFT", "KC_DOWN", "KC_RGHT", "KC_MHEN", "KC_NO", "KC_NO", "KC_HENK", "KC_4", "KC_5", "KC_6", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_1", "KC_2", "KC_3", "KC_NO", "KC_NO", "KC_0", "KC_PDOT", "KC_NO", "KC_TRNS", "KC_DEL", "KC_NO", "KC_NO", "KC_NO", "KC_PGUP", "KC_END", "KC_NO", "KC_NO", "KC_HOME", "KC_PGDN"],
                    ["KC_DLR", "KC_JYEN", "KC_PIPE", "KC_AMPR", "KC_LPRN", "KC_RPRN", "KC_COLN", "KC_SCLN", "KC_CIRC", "KC_GRV", "KC_AT", "KC_HASH", "KC_PERC", "LSFT(KC_7)", "KC_LBRC", "KC_RBRC", "KC_ASTR", "KC_PSLS", "KC_PPLS", "KC_UNDS", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_LCBR", "KC_RCBR", "KC_NO", "KC_LT", "KC_GT", "KC_EXLM", "KC_NO", "KC_NO", "KC_QUOT", "KC_EQL", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_TRNS", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO"],
                    ["KC_F1", "KC_F2", "KC_F3", "KC_F4", "KC_F5", "RGB_TOG", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_F6", "KC_F7", "KC_F8", "KC_F9", "KC_F10", "RGB_MOD", "RGB_SPI", "RGB_HUI", "RGB_SAI", "RGB_VAI", "KC_F11", "KC_F12", "KC_NO", "KC_NO", "KC_NO", "RGB_RMOD", "RGB_SPD", "RGB_HUD", "RGB_SAD", "RGB_VAD", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_NO", "KC_BTN1", "KC_BTN2", "KC_NO", "KC_NO", "KC_MS_U", "KC_MS_R", "KC_TRNS", "KC_NO", "KC_MS_L", "KC_MS_D"]
                ],
                "author": ""
            }
        )
    }

    // keymap_jp.hã‚’å‚è€ƒã«ä½œã£ãŸã€JISç’°å¢ƒã§å…¥åŠ›ã—ãŸã„è¨˜å·â†’USã‚­ãƒ¼ã®å¯¾å¿œè¡¨
    const jis_us_array = [
        ['KC_ZKHK', 'KC_GRV'], // Zenkaku â†”ï¸ Hankaku â†” Kanji (åŠè§’ â†” å…¨è§’ â†” æ¼¢å­—)
        ['KC_CIRC', 'KC_EQL'], // ^
        ['KC_YEN', 'KC_INT3'], // Â¥
        ['KC_AT', 'KC_LBRC'], // @
        ['KC_LBRC', 'KC_RBRC'], // [
        ['KC_EISU', 'KC_CAPS'], // EisÅ« (è‹±æ•°)
        ['KC_COLN', 'KC_QUOT'], // :
        ['KC_RBRC', 'KC_NUHS'], // ]
        ['KC_BSLS', 'KC_INT1'], // (backslash)
        ['KC_MHEN', 'KC_INT5'], // Muhenkan (ç„¡å¤‰æ›)
        ['KC_HENK', 'KC_INT4'], // Henkan (å¤‰æ›)
        ['KC_KANA', 'KC_INT2'], // Katakana â†” Hiragana â†” RÅmaji (ã‚«ã‚¿ã‚«ãƒŠ â†” ã²ã‚‰ãŒãª â†” ãƒ­ãƒ¼ãƒå­—)
        ['KC_HASH', 'S(KC_3)'], // #
        ['KC_AMPR', 'S(KC_6)'], // &
        ['KC_QUOT', 'S(KC_7)'], // '
        ['KC_LPRN', 'S(KC_8)'], // (
        ['KC_RPRN', 'S(KC_9)'], // )
        ['KC_EQL', 'S(KC_MINS)'], // =
        ['KC_PEQL', 'S(KC_MINS)'], // =
        ['KC_TILD', 'S(KC_EQL)'], // ~
        ['KC_PIPE', 'S(KC_INT3)'], // |
        ['KC_GRV', 'S(KC_LBRC)'], // `
        ['KC_LCBR', 'S(KC_RBRC)'], // {
        ['KC_PLUS', 'S(KC_SCLN)'], // +
        ['KC_PPLS', 'S(KC_SCLN)'], // +
        ['KC_ASTR', 'S(KC_QUOT)'], // *
        ['KC_PAST', 'S(KC_QUOT)'], // *
        ['KC_RCBR', 'S(KC_NUHS)'], // }
        ['KC_UNDS', 'S(KC_INT1)'], // _
        ['KC_ZHTG', 'KC_GRV'], // Zenkaku â†”ï¸ Hankaku â†” Kanji (åŠè§’ â†” å…¨è§’ â†” æ¼¢å­—)
        ['KC_DQUO', 'S(KC_2)'], // "
        ['KC_MEISU', 'KC_LANG2'], // EisÅ« (è‹±æ•°) on macOS
        ['KC_MKANA', 'KC_LANG1'] // Kana (ã‹ãª) on macOS
    ]

    let input_area = document.getElementById("input");
    let log_area = document.getElementById("log");

    let work_as_jis = (keymap) => {
        // ç½®æ›ã®ãŸã‚ã«ã„ã£ãŸã‚“æ–‡å­—åˆ—ã«ã™ã‚‹
        let layers = JSON.stringify(keymap.layers, null, 3);
        log_area.value = ''

        // keymap_jp.hã‚’ã‚‚ã¨ã«ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç½®æ›ã™ã‚‹
        jis_us_array.forEach(key => {

            log_area.value += key[0] + '\t->\t' + key[1] + '\n';

            // ç½®æ›ã—ãŸã‚­ãƒ¼ã¯ã€äºŒé‡ç½®æ›ã‚’é˜²ããŸã‚ã«ã„ã£ãŸã‚“ãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã¦ãŠã
            layers = layers.replace(`"${key[0]}"`, `"${key[1]}ğŸ£"`);
        });

        // ãƒ•ãƒ©ã‚°ã‚’å¤–ã™
        layers = layers.replace(/ğŸ£/g, '');

        // keymapæ›¸ãæˆ»ã—ã¦
        keymap.layers = JSON.parse(layers);

        // å¤‰æ›ã‚’æ›ã‘ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ã£ã¦ã‚ã‹ã‚‹ã‚ˆã†ã«ãƒ¡ãƒ¢ã—ã¦
        keymap.keymap = keymap.keymap + '-jis-like';

        return keymap
    }

    let execute_convert = () => {

        try {
            let input = JSON.parse(input_area.value)
            let output = work_as_jis(input);

            // å¤‰æ›å¾Œã®jspnã‚’è‡ªå‹•ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            let blob = new Blob([JSON.stringify(output)], { type: "text/json" });
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = output.keyboard + '-' + output.keymap + '.json';
            link.click();
            //            alert("å¤‰æ›ã—ã¾ã—ãŸï¼");

        } catch (e) {
            log_area.value = `ğŸ˜¨ ${e}`;
        }
    }

</script>

</html>